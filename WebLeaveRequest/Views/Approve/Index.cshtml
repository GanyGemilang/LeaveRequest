
<div class="p-3">
    <h4 class="text-muted font-18 m-b-5 text-center">Welcome</h4>
    <p class="text-muted text-center">Approve Data Leave Request.</p>
    
    <div class="container-fluid mt-5">
        <table id="myTable" class="table table-striped table-bordered dataTable" style="width:100%">
            <thead class="thead-light">
                <tr role="row">
                    <th>No</th>
                    <th>Id</th>
                    <th>NIK</th>
                    <th>First Name</th>
                    <th>Reason Request</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Status</th>
                    <th>Notes</th>
                    <th>Approved HRD</th>
                    <th>Approved Manager</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                    <th>No</th>
                    <th>Id</th>
                    <th>NIK</th>
                    <th>First Name</th>
                    <th>Reason Request</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Status</th>
                    <th>Notes</th>
                    <th>Approved HRD</th>
                    <th>Approved Manager</th>
                    <th>Action</th>
                </tr>
            </tfoot>
            <tbody></tbody>
        </table>
    </div>
</div>

    @section scripts
{
        <script>
            var table = null;
            $(document).ready(function () {
                table = $("#myTable").DataTable({
                    "filter": true,
                    "orderMulti": false,
                    "ajax": {
                        "url": "https://localhost:44330/api/request",
                        "type": "get",
                        "datatype": "json",
                        "dataSrc": "data"
                    },
                    "columnDefs": [
                        {
                            "targets": [1, 8, 9],
                            "visible": false,

                        },
                        {
                            "targets": [0, 2],
                            "searchable": true
                        },
                        {
                            "targets": [3],
                            "searchable": false,
                            "orderable": false
                        },
                    ],
                    "columns": [
                        {
                            "data": null,
                            "render": function (data, type, row, meta) {
                                return meta.row + meta.settings._iDisplayStart + 1;
                            }
                        },
                        {
                            "data": 'id'
                        },
                        {
                            "data": 'nik'
                        },
                        {
                            "data": 'User.firstName'
                        },
                        {
                            "data": 'reasonRequest'
                        },
                        {
                            "data": 'startDate'
                        },
                        {
                            "data": 'endDate'
                        },
                        {
                            "data": 'status'
                        },
                        {
                            "data": 'notes'
                        },
                        {
                            "data": 'approvedHRD'
                        },
                        {
                            "data": 'approvedManager'
                        },
                        {
                            "data": 'id',
                            "render": function (data, type, row, meta) {
                                return '<a href="javascript:void(0)" class="far fa-check-circle table-action text-dark" data-toggle="tooltip" data-placement="top" title="Approve" onclick="Approve(\'' + row['id'] + '\')"></a> ' +
                                    '<a href="javascript:void(0)" class="far fa-times-circle table-action text-danger" data-toggle="tooltip" data-placement="top" title="Reject" onclick="Reject(\'' + row['id'] + '\')"></a>'
                            }
                        }
                    ]
                });
            });

            function Get(id) {
                console.log(id);
                $.ajax({
                    url: "/Request/Get",
                    data: { id: id }
                }).done((result) => {
                    console.log(result);
                    var obj = JSON.parse(result);
                    $("#Request").modal("show");
                    $("#nik").val(obj.data.nik);
                    $("#id").val(obj.data.id);
                    $("#reasonrequest").val(obj.data.reasonRequest);
                    $("#startdate").val(obj.data.startDate);
                    $("#enddate").val(obj.data.endDate);
                    $("#notes").val(obj.data.notes);
                    $("#ApprovedHRD").val(obj.data.approvedHRD);
                    $("#ApprovedManager").val(obj.data.approvedManager);
                }).fail((error) => {
                    console.log(error);
                })
            }

            function Approve(id) {
                $.ajax({
                    type: "PUT",
                    url: '/approve/Approve',
                    data: { id: id }
                }).done((result) => {
                    console.log("ok");
                    if (result == 200) {
                        swal('Success', 'Update Successfully', 'success');
                        table.ajax.reload();
                    }
                    else {
                        swal('Error', 'Something Went Wrong', 'error');
                    }
                }).fail((error) => {
                    console.log(error)
                });
            }

            function Reject(id) {
                $.ajax({
                    type: "PUT",
                    url: '/approve/Reject',
                    data: { id: id }
                }).done((result) => {

                    if (result == 200) {
                        swal('Success', 'Update Successfully', 'success');
                        table.ajax.reload();
                    }
                    else {
                        swal('Error', 'Something Went Wrong', 'error');
                    }
                }).fail((error) => {
                    console.log(error)
                });
            }

        </script>
    }
